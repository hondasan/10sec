<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>10ç§’ã´ã£ãŸã‚Šã‚²ãƒ¼ãƒ </title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 20px;
      position: relative;
      overflow-x: hidden;
      overflow-y: hidden;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 30px;
    }

    /* ãƒœã‚¿ãƒ³ã‚’ä¸­å¤®ã«é…ç½® */
    .button-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    /* START/STOPãƒœã‚¿ãƒ³ */
    #toggleBtn {
      width: 50vmin;
      height: 50vmin;
      border-radius: 50%;
      background-color: #007bff; /* STARTæ™‚ã®è‰² */
      color: #fff;
      font-size: 3rem;  /* æ–‡å­—ã‚’å¤§ãã */
      border: none;
      outline: none;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    #toggleBtn:active {
      opacity: 0.9;
    }

    /* æŠ¼ã—ãŸã¨ãã®è»½ã„æ‹¡å¤§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .pressAnimation {
      animation: pressAnim 0.2s forwards;
    }
    @keyframes pressAnim {
      50% {
        transform: scale(1.1);
      }
      100% {
        transform: scale(1);
      }
    }

    /* ãƒœã‚¿ãƒ³ãŒä¸è¦å‰‡ã«ãƒ‰ã‚¯ãƒ‰ã‚¯(pulse)ã™ã‚‹ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .pulseAnimation {
      animation: throb 1s ease-in-out;
    }
    @keyframes throb {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.2); }
      100% { transform: scale(1); }
    }

    /* ç¶™ç¶šçš„ã«å‡ºç¾ã™ã‚‹ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®è¦ç´  */
    .random-animation {
      position: fixed;
      font-size: 2rem;
      pointer-events: none;
      opacity: 0;
      animation: floatAnim 2s linear forwards;
      z-index: 999;
    }
    @keyframes floatAnim {
      0% {
        transform: translate(0, 0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translate(0, -200px) scale(0.5);
        opacity: 0;
      }
    }

    /* çµæœè¡¨ç¤º */
    #result {
      font-size: 1.2em;
      margin: 15px 0;
      white-space: pre-wrap; /* \n ã‚’æ”¹è¡Œã§è¡¨ç¤º */
      min-height: 6em;       /* ã‚ã‚‹ç¨‹åº¦ã®é«˜ã•ã‚’ç¢ºä¿ã—ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå´©ã‚Œé˜²æ­¢ */
    }

    /* è¨ˆæ¸¬æ™‚é–“ã‚’ã‚ˆã‚Šç›®ç«‹ã¤ã‚ˆã†ã«ã™ã‚‹ */
    .elapsed-time {
      font-size: 1.6em;
      font-weight: bold;
      color: #e74c3c; /* red */
      display: inline-block;
      margin-bottom: 5px;
    }

    /* ãƒ©ãƒ³ã‚¯è¡¨ç¤ºã‚’å¤§ããã™ã‚‹ */
    .rank-text {
      font-size: 2em;
      font-weight: bold;
    }

    /* ãƒ©ãƒ³ã‚¯ã®è‰²ä»˜ã‘ */
    .rank-S { color: #f1c40f; } /* gold */
    .rank-A { color: #e67e22; } /* orange */
    .rank-B { color: #3498db; } /* blue */
    .rank-C { color: #2ecc71; } /* green */
    .rank-D { color: #9b59b6; } /* purple */
    .rank-E { color: #e74c3c; } /* red  */

    /* Sãƒ©ãƒ³ã‚¯ã§ç¥ç¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ˜ŸãŒèˆã†ï¼‰ */
    .star {
      position: fixed;
      color: #f1c40f;  /* gold */
      font-size: 2em;
      pointer-events: none;
      animation: starFall 1.5s linear forwards;
      z-index: 9999;
    }
    @keyframes starFall {
      0% {
        opacity: 1;
        transform: translateY(-50px) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(500px) rotate(360deg);
      }
    }

    /* ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º */
    #rankingContainer {
      margin-top: 20px;
      text-align: left;
      max-width: 420px;
      margin-left: auto;
      margin-right: auto;
      font-size: 0.95em;
    }
    .ranking-title {
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .ranking-item {
      margin-bottom: 5px;
      line-height: 1.4em;
    }

    /* ãƒ©ãƒ³ã‚¯åˆ¤å®šè¡¨ */
    #rankGuide {
      max-width: 420px;
      margin: 20px auto;
      text-align: left;
      font-size: 0.9em;
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
    }
    #rankGuide h2 {
      font-size: 1em;
      margin: 0 0 6px;
      font-weight: bold;
    }
    .rank-row {
      margin: 4px 0;
    }
  </style>
</head>
<body>

  <h1>10ç§’ã´ã£ãŸã‚Šã‚²ãƒ¼ãƒ </h1>

  <div class="button-container">
    <button id="toggleBtn">START</button>
  </div>

  <div id="result"></div>

  <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤ºé ˜åŸŸ -->
  <div id="rankingContainer">
    <div class="ranking-title">Top 5 Records (Best to Worse)</div>
    <div id="rankingList"></div>
  </div>

  <!-- ãƒ©ãƒ³ã‚¯åˆ¤å®šè¡¨ -->
  <div id="rankGuide">
    <h2>ãƒ©ãƒ³ã‚¯åˆ¤å®šä¸€è¦§</h2>
    <div class="rank-row">S ãƒ©ãƒ³ã‚¯: 10ç§’ã¨ã®å·® < 0.01 ç§’</div>
    <div class="rank-row">A ãƒ©ãƒ³ã‚¯: 0.1 ç§’æœªæº€</div>
    <div class="rank-row">B ãƒ©ãƒ³ã‚¯: 0.3 ç§’æœªæº€</div>
    <div class="rank-row">C ãƒ©ãƒ³ã‚¯: 0.7 ç§’æœªæº€</div>
    <div class="rank-row">D ãƒ©ãƒ³ã‚¯: 1.0 ç§’æœªæº€</div>
    <div class="rank-row">E ãƒ©ãƒ³ã‚¯: 1.0 ç§’ä»¥ä¸Š</div>
    <div class="rank-row">â€» ã´ã£ãŸã‚Š10.00000sã¯ç‰¹åˆ¥ï¼</div>
  </div>

  <script>
    let startTime = 0;        // STARTãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸæ™‚åˆ»
    let isRunning = false;    // ã‚¿ã‚¤ãƒãƒ¼ãŒå‹•ä½œä¸­ã‹ã©ã†ã‹
    let animationRunning = false; // ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆ¶å¾¡
    let pulseRunning = false; // ãƒœã‚¿ãƒ³è„ˆå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¯æœ€å¤§100ä»¶ã‚’ä¿æŒ
    const MAX_RECORDS = 100;
    // è¡¨ç¤ºã¯ä¸Šä½5ä»¶
    const DISPLAY_LIMIT = 5;
    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ä¸Šã«ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç”¨ã®ã‚­ãƒ¼
    const STORAGE_KEY = "tenSecRankingV4";

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ—¢å­˜ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’è¡¨ç¤º
    window.addEventListener('DOMContentLoaded', () => {
      displayRanking();
    });

    // â˜… ãƒ©ãƒ³ã‚¯åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (diff: 10ç§’ã¨ã®å·®)
    //   S: < 0.01
    //   A: < 0.1
    //   B: < 0.3
    //   C: < 0.7
    //   D: < 1.0
    //   E: ãã‚Œä»¥ä¸Š
    function getRank(diff) {
      if (diff < 0.01) {
        return "S";
      } else if (diff < 0.1) {
        return "A";
      } else if (diff < 0.3) {
        return "B";
      } else if (diff < 0.7) {
        return "C";
      } else if (diff < 1.0) {
        return "D";
      } else {
        return "E";
      }
    }

    // ===== ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¾¤ =====
    // 5ä½ä»¥å†…(ç¥ç¦)ãƒ‘ã‚¿ãƒ¼ãƒ³
    const blessingMessages = [
      "ãµã¯ã¯ã¯â€¦æ¼†é»’ã®ç¥ç¦ã‚’å—ã‘ã‚‹ãŒã„ã„ã€é¸ã°ã‚Œã—è€…ã‚ˆâ€¦ï¼",
      "é—‡ã®è¦‡ç‹ãŒå¾®ç¬‘ã‚€â€¦ã€‚ãŠå‰ã®åŠ›ã¯çœŸã«ç›®è¦šã‚ãŸã‚ˆã†ã ãªâ€¦ï¼",
      "æ™‚ã®æ­ªã¿ã™ã‚‰ã­ã˜ä¼ã›ãŸã‹â€¦ã•ã™ãŒã ãªï¼",
      "è™šç„¡ã®æ·±æ·µã•ãˆå‡Œé§•ã™ã‚‹ã¨ã¯â€¦è¦‹äº‹ãªã¾ã§ã®ç‹‚æ°—â€¦ï¼",
      "ãŠå‰ã®æ³¢å‹•ã‚’æ„Ÿã˜ã‚‹â€¦ã€‚ãã®é«˜ã¿ã¸æ›´ã«ä¸Šã‚Šè©°ã‚ã‚â€¦ï¼"
    ];
    // 6ä½ä»¥ä¸Š(ç…½ã‚Š)ãƒ‘ã‚¿ãƒ¼ãƒ³
    const tauntingMessages = [
      "è²´æ§˜ãªã©é—‡ã®åº•ã«æ²ˆã‚€é‹å‘½â€¦ç²¾é€²ã™ã‚‹ãŒã„ã„ã€‚",
      "ã“ã®ç¨‹åº¦ã®åŠ›ã‹â€¦å¤±æœ›ã•ã›ã¦ãã‚Œã‚‹ãªã‚ˆï¼Ÿ",
      "è…ã‚Šã‹ã‘ãŸé­‚ã®å˜†ããŒèã“ãˆã‚‹â€¦ã€‚ã‚‚ã£ã¨æš´ã‚Œã¦ã¿ã›ã‚â€¦ï¼",
      "é—‡ã®çœ·å±(ã‘ã‚“ãã)ã«ã¯ç¨‹é ã„ãªâ€¦ä»Šã¯ãŸã ã®å¡µã ã€‚",
      "ãµã£â€¦ãã®ç¨‹åº¦ã‹ã€‚é—‡ã®å®´ã«å‚åˆ—ã™ã‚‹è³‡æ ¼ã¯ã¾ã ãªã„ã€‚"
    ];
    // ã´ã£ãŸã‚Šã®æ™‚ï¼ˆdiff === 0ï¼‰ã®ç‰¹åˆ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    const perfectMessage = "â€¦ã¬ã…â€¦ã“ã‚Œã¯â€¦å®Œå…¨ãªã‚‹è™šç©ºã¨ã®èåˆâ€¦ï¼";

    // ===== ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–¢ä¿‚ =====
    // ç¶™ç¶šçš„ã«ç”»é¢ä¸Šã«ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å‡ºã™(ä¸è¦å‰‡é–“éš”)
    function startRandomAnimation() {
      if (animationRunning) return;
      animationRunning = true;

      (function spawnNext() {
        // 0.8ç§’ï½3ç§’ã®é–“ã§ãƒ©ãƒ³ãƒ€ãƒ 
        const nextDelay = Math.random() * 2200 + 800;
        spawnRandomElement();
        setTimeout(() => {
          if (isRunning) {
            spawnNext();
          } else {
            animationRunning = false;
          }
        }, nextDelay);
      })();
    }
    // ç”»é¢ã«ãƒ©ãƒ³ãƒ€ãƒ ãªçµµæ–‡å­—ã‚’è¡¨ç¤º â†’ ä¸Šã¸æµã‚Œã¦æ¶ˆãˆã‚‹
    function spawnRandomElement() {
      const element = document.createElement('div');
      element.classList.add('random-animation');

      const emojis = ["âœ¨","ğŸ”¥","ğŸ’«","ğŸŒ¿","âš¡","ğŸ‰","ğŸ¶","ğŸ’¥","ğŸ€","ğŸŒ€","ğŸ•¸","ğŸŒˆ"];
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      element.textContent = randomEmoji;

      const xPos = Math.random() * window.innerWidth * 0.8; 
      const yPos = Math.random() * window.innerHeight * 0.8 + window.innerHeight; 
      element.style.left = xPos + "px";
      element.style.top = yPos + "px";

      const colors = ["#e74c3c","#9b59b6","#3498db","#2ecc71","#e67e22","#f1c40f"];
      element.style.color = colors[Math.floor(Math.random() * colors.length)];
      const size = Math.random() * 2 + 1; // 1~3å€
      element.style.fontSize = (2 * size) + "rem";

      document.body.appendChild(element);
      element.addEventListener('animationend', () => {
        element.remove();
      });
    }

    // STARTå¾Œã«ãƒœã‚¿ãƒ³ãŒä¸è¦å‰‡ã«è„ˆå‹•ã™ã‚‹
    function startButtonPulse() {
      if (pulseRunning) return;
      pulseRunning = true;

      (function pulseNext() {
        // 1ï½4ç§’ã®é–“éš”ã§ãƒ©ãƒ³ãƒ€ãƒ 
        const nextDelay = Math.random() * 3000 + 1000;
        pulseOnce();
        setTimeout(() => {
          if (isRunning) {
            pulseNext();
          } else {
            pulseRunning = false;
          }
        }, nextDelay);
      })();
    }
    // ãƒœã‚¿ãƒ³ã«è„ˆå‹•ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€åº¦ã ã‘ä»˜ä¸â†’çµ‚äº†å¾Œã«å‰Šé™¤
    function pulseOnce() {
      const btn = document.getElementById("toggleBtn");
      btn.classList.add("pulseAnimation");
      btn.addEventListener("animationend", () => {
        btn.classList.remove("pulseAnimation");
      }, { once: true });
    }

    // Sãƒ©ãƒ³ã‚¯ or 5ä½ä»¥å†…ã§ç¥ç¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ (æ˜ŸãŒèˆã†)
    function spawnBlessingAnimation() {
      for (let i = 0; i < 20; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        star.textContent = 'â˜…';
        const xPos = Math.random() * window.innerWidth;
        const yPos = Math.random() * 100 - 100; 
        star.style.left = `${xPos}px`;
        star.style.top = `${yPos}px`;

        document.body.appendChild(star);
        star.addEventListener('animationend', () => {
          star.remove();
        });
      }
    }

    // START/STOP ãƒœã‚¿ãƒ³
    const toggleBtn = document.getElementById("toggleBtn");
    toggleBtn.addEventListener("click", function() {
      // æŠ¼ã—ãŸã‚¢ãƒ‹ãƒ¡ä»˜ä¸â†’çµ‚äº†å¾Œã«å‰Šé™¤
      toggleBtn.classList.add("pressAnimation");
      toggleBtn.addEventListener("animationend", () => {
        toggleBtn.classList.remove("pressAnimation");
      }, { once: true });

      if (!isRunning) {
        // ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
        isRunning = true;
        startTime = performance.now();

        this.textContent = "STOP";
        this.style.backgroundColor = "#dc3545"; // STOPæ™‚ã®è‰²

        document.getElementById("result").textContent = "";
        startRandomAnimation();  // ãƒ©ãƒ³ãƒ€ãƒ ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
        startButtonPulse();      // ãƒœã‚¿ãƒ³è„ˆå‹•ã‚¢ãƒ‹ãƒ¡é–‹å§‹

      } else {
        // ã‚¿ã‚¤ãƒãƒ¼åœæ­¢
        isRunning = false;
        const endTime = performance.now();
        const elapsedSec = (endTime - startTime) / 1000;
        const diff = Math.abs(elapsedSec - 10);
        
        // çµæœè¡¨ç¤º
        const resultEl = document.getElementById("result");
        // ã´ã£ãŸã‚Š(10.00000s)ã‹ã©ã†ã‹
        const isPerfect = (elapsedSec.toFixed(5) === "10.00000");

        // ãƒ©ãƒ³ã‚¯å–å¾—
        const rankSymbol = getRank(diff);
        const rankHtml = `<span class="rank-text rank-${rankSymbol}">${rankSymbol}</span>`;

        let baseText = 
          `ã‚ãªãŸã®ã‚¿ã‚¤ãƒ :\n` +
          `<span class="elapsed-time">${elapsedSec.toFixed(5)} s</span>\n\n` +
          `10ç§’ã¨ã®å·®: ${diff.toFixed(5)} s\n` +
          `ãƒ©ãƒ³ã‚¯: ${rankHtml}\n`;

        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°æ›´æ–°
        const currentRank = updateRanking(diff, elapsedSec);

        // ã¾ãšã¯çµæœæ–‡å­—åˆ—ã‚’ä½œã‚‹
        if (isPerfect) {
          // å®Œå…¨ã« 10.00000s ã®ã¨ã
          baseText += `\n${perfectMessage}`;
        } else {
          // é€šå¸¸
          if (currentRank <= 5) {
            // 5ä½ä»¥å†… => ç¥ç¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸(ãƒ©ãƒ³ãƒ€ãƒ )
            const blessing = blessingMessages[Math.floor(Math.random() * blessingMessages.length)];
            baseText += `\n${blessing}`;
          } else {
            // 6ä½ä»¥ä¸Š => ç…½ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸(ãƒ©ãƒ³ãƒ€ãƒ )
            const taunt = tauntingMessages[Math.floor(Math.random() * tauntingMessages.length)];
            baseText += `\n${taunt} (${currentRank}ä½)`;
          }
        }

        resultEl.innerHTML = baseText;

        // 5ä½ä»¥å†…ã¾ãŸã¯Sãƒ©ãƒ³ã‚¯ã®ã¨ãã«ç¥ç¦ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
        if (currentRank <= 5 || rankSymbol === "S") {
          spawnBlessingAnimation();
        }

        // ãƒœã‚¿ãƒ³çŠ¶æ…‹ã‚’æˆ»ã™
        this.textContent = "START";
        this.style.backgroundColor = "#007bff";
      }
    });

    // ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°å‡¦ç† =====
    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°(æœ€å¤§100ä»¶)ã‚’ãƒ­ãƒ¼ãƒ‰
    function loadRanking() {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        return JSON.parse(data);
      }
      return [];
    }

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ä¿å­˜
    function saveRanking(ranking) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(ranking));
    }

    // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ç”»é¢è¡¨ç¤º (ä¸Šä½5å)
    function displayRanking() {
      const rankingListEl = document.getElementById("rankingList");
      rankingListEl.innerHTML = ""; // ãƒªã‚»ãƒƒãƒˆ

      const rankingData = loadRanking();
      if (rankingData.length === 0) {
        rankingListEl.textContent = "ã¾ã è¨˜éŒ²ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚";
        return;
      }

      // ä¸Šä½5ä»¶ã®ã¿è¡¨ç¤º
      const top5 = rankingData.slice(0, DISPLAY_LIMIT);
      top5.forEach((item, idx) => {
        const rankSymbol = getRank(item.difference);
        const rankClass = `rank-${rankSymbol}`;
        const div = document.createElement('div');
        div.className = "ranking-item";
        div.innerHTML =
          `<strong>${idx+1}ä½</strong> : ` +
          `<span class="${rankClass}">${item.difference.toFixed(5)}s</span> / ` +
          `${item.timeElapsed.toFixed(5)}s / ` +
          `${item.date} (ãƒ©ãƒ³ã‚¯: ${rankSymbol})`;
        rankingListEl.appendChild(div);
      });
    }

    // æ–°ã—ã„è¨˜éŒ²ã‚’ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«åæ˜ ã—ã€ä»Šå›ã®é †ä½(1-based)ã‚’è¿”ã™
    function updateRanking(diff, elapsedSec) {
      let rankingData = loadRanking();

      const now = new Date();
      const record = {
        difference: diff,
        timeElapsed: elapsedSec,
        date: formatDate(now),
        timestamp: now.getTime() // åŒå·®ã®å ´åˆã®é †åºåˆ¤å®šã«ä½¿ç”¨
      };

      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¿½åŠ  & ã‚½ãƒ¼ãƒˆ
      rankingData.push(record);
      rankingData.sort((a, b) => {
        if (a.difference === b.difference) {
          // å·®ãŒåŒã˜ãªã‚‰ timestamp ãŒå°ã•ã„ã»ã†ã‚’å…ˆã«
          return a.timestamp - b.timestamp;
        }
        return a.difference - b.difference;
      });

      // ä¸Šä½100ä»¶ã®ã¿ä¿æŒ
      rankingData = rankingData.slice(0, MAX_RECORDS);

      // ä»Šå›ã®é †ä½ã‚’è¨ˆç®— (0-based index â†’ +1)
      let newRecordIndex = -1;
      for (let i = rankingData.length - 1; i >= 0; i--) {
        if (rankingData[i].timestamp === record.timestamp) {
          newRecordIndex = i;
          break;
        }
      }
      const finalRank = newRecordIndex + 1;

      // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜ & è¡¨ç¤ºæ›´æ–°
      saveRanking(rankingData);
      displayRanking();

      return finalRank;
    }

    // æ—¥æ™‚ã‚’ yyyy-MM-dd HH:mm:ss å½¢å¼ã§è¿”ã™
    function formatDate(dateObj) {
      const yyyy = dateObj.getFullYear();
      const mm = String(dateObj.getMonth()+1).padStart(2, '0');
      const dd = String(dateObj.getDate()).padStart(2, '0');
      const hh = String(dateObj.getHours()).padStart(2, '0');
      const min = String(dateObj.getMinutes()).padStart(2, '0');
      const ss = String(dateObj.getSeconds()).padStart(2, '0');
      return `${yyyy}-${mm}-${dd} ${hh}:${min}:${ss}`;
    }
  </script>
</body>
</html>